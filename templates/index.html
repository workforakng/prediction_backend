<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WinGo 1 Min Lottery Prediction Dashboard</title>
<style>
  /* --- Reset & Base Styles --- */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
    min-height: 100vh;
    line-height: 1.5;
  }

  /* --- Sticky Header --- */
  .sticky-header {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    padding: 0.8rem 1rem;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
  }

  .header-title {
    font-size: 1.6rem;
    font-weight: 800;
    margin-bottom: 0.3rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    letter-spacing: 1px;
  }

  .header-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    margin-top: 0.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .timestamp-info {
    background: rgba(255,255,255,0.2);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    backdrop-filter: blur(5px);
  }

  .countdown-timer {
    background: rgba(255,193,7,0.9);
    color: #1e3c72;
    padding: 0.4rem 1rem;
    border-radius: 25px;
    font-weight: 700;
    font-size: 1rem;
    box-shadow: 0 2px 10px rgba(255,193,7,0.4);
    animation: pulse 2s ease-in-out infinite alternate;
  }

  @keyframes pulse {
    from { transform: scale(1); }
    to { transform: scale(1.05); }
  }

  /* --- Main Container --- */
  .main-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem;
  }

  /* --- Section Styles --- */
  .dashboard-section {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .dashboard-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .section-header {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid #667eea;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* --- Grid Layouts --- */
  .grid-2 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .grid-3 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  /* --- Main Prediction Display --- */
  .prediction-display {
    text-align: center;
    padding: 1rem;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    border-radius: 15px;
    color: white;
    margin-bottom: 1rem;
  }

  .prediction-numbers {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin: 1rem 0;
    flex-wrap: wrap;
  }

  .number-bubble {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 1.8rem;
    font-weight: 800;
    color: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .number-bubble:hover {
    transform: scale(1.1) rotate(5deg);
  }

  .bubble-pct {
    font-size: 0.7rem;
    margin-top: 2px;
    background: rgba(0,0,0,0.3);
    padding: 1px 4px;
    border-radius: 8px;
  }

  /* --- Prediction Cards --- */
  .prediction-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  }

  .prediction-value {
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0.5rem 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .prediction-meta {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 0.5rem;
  }

  /* --- Pattern Prediction Boxes --- */
  .pattern-display {
    text-align: center;
    padding: 1rem;
  }

  .pattern-box {
    font-size: 2rem;
    font-weight: 800;
    padding: 1rem 2rem;
    border-radius: 15px;
    display: inline-block;
    min-width: 150px;
    margin: 0.5rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
  }

  .pattern-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }

  .pattern-box.Red { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; }
  .pattern-box.Green { background: linear-gradient(135deg, #51cf66 0%, #40c057 100%); color: white; }
  .pattern-box.Big { background: linear-gradient(135deg, #ff8c42 0%, #ff6b35 100%); color: white; }
  .pattern-box.Small { background: linear-gradient(135deg, #4c6ef5 0%, #364fc7 100%); color: white; }
  .pattern-box.Pending { background: linear-gradient(135deg, #868e96 0%, #6c757d 100%); color: white; }

  /* --- AI Section Styles --- */
  .ai-section {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    border: 2px solid #ff8c42;
  }

  .ai-toggle-btn {
    background: linear-gradient(135deg, #ff8c42 0%, #ff6b35 100%);
    color: white;
    border: none;
    border-radius: 25px;
    padding: 0.6rem 1.5rem;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255,140,66,0.4);
  }

  .ai-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255,140,66,0.6);
  }

  .ai-toggle-btn.active {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  }

  .ai-badge {
    background: #ff8c42;
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.9rem;
    font-weight: 700;
    display: inline-block;
    margin-top: 0.5rem;
  }

  /* --- Chip Styles --- */
  .chip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin: 0.2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
  }

  .chip:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  .chip.red { background: #e53935; color: #fff; }
  .chip.green { background: #4caf50; color: #fff; }
  .chip.violet { background: #9c27b0; color: #fff; }
  .chip.gray { background: #9e9e9e; color: #fff; }
  .chip.blue { background: #2196f3; color: #fff; }
  .chip.gold { background: #ffc107; color: #333; }

  .chip.Result-Green { background: #4caf50; color: #fff; }
  .chip.Result-Red { background: #e53935; color: #fff; }
  .chip.Result-Violet { background: #9c27b0; color: #fff; }
  .chip.Result-Pending { background: #9e9e9e; color: #fff; }
  .chip.Result-Big { background: #ff9800; color: #fff; }
  .chip.Result-Small { background: #3f51b5; color: #fff; }

  /* --- Table Styles --- */
  .data-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    font-size: 0.85rem;
  }

  .data-table thead {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .data-table th,
  .data-table td {
    padding: 0.6rem 0.4rem;
    text-align: center;
    border-bottom: 1px solid rgba(0,0,0,0.05);
  }

  .data-table tbody tr {
    background: rgba(255,255,255,0.8);
    transition: all 0.2s ease;
  }

  .data-table tbody tr:hover {
    background: rgba(102,126,234,0.1);
    transform: scale(1.01);
  }

  .data-table tbody tr:nth-child(even) {
    background: rgba(255,255,255,0.5);
  }

  .correct { color: #2e7d32; font-weight: 700; }
  .incorrect { color: #c62828; font-weight: 700; }

  /* --- Statistics Cards --- */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .stat-card {
    background: linear-gradient(135deg, #f8f9ff 0%, #e8f0fe 100%);
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border: 1px solid rgba(102,126,234,0.2);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }

  .stat-label {
    color: #667eea;
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 0.3rem;
  }

  .stat-value {
    color: #1e3c72;
    font-weight: 800;
    font-size: 1.3rem;
  }

  /* --- Previous Draw Display --- */
  .previous-draw {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem;
    border-radius: 15px;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .previous-draw strong {
    font-size: 1.4rem;
    color: #ffc107;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  }

  /* --- Error Message --- */
  .error-message {
    background: #ffebee;
    color: #c62828;
    border: 2px solid #e57373;
    border-radius: 10px;
    padding: 1rem;
    margin: 1rem 0;
    text-align: center;
    font-weight: 600;
    display: none;
    box-shadow: 0 4px 15px rgba(229,115,115,0.3);
  }

  /* --- Raw JSON Section --- */
  .json-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  .json-dropdown {
    background: #f8f9ff;
    border: 2px solid #667eea;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .json-dropdown:hover {
    border-color: #4c63d2;
  }

  .json-display {
    background: #1a1a1a;
    color: #e0e0e0;
    padding: 1.5rem;
    border-radius: 10px;
    overflow-x: auto;
    max-height: 300px;
    font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
    font-size: 0.8rem;
    position: relative;
    box-shadow: inset 0 4px 15px rgba(0,0,0,0.3);
    white-space: pre-wrap;
    word-break: break-all;
  }

  .copy-btn {
    background: #667eea;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.4rem 1rem;
    cursor: pointer;
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 0.8rem;
    transition: all 0.2s ease;
  }

  .copy-btn:hover {
    background: #4c63d2;
    transform: translateY(-1px);
  }

  /* --- Responsive Design --- */
  @media (max-width: 768px) {
    .header-title {
      font-size: 1.3rem;
    }

    .header-info {
      flex-direction: column;
      gap: 0.5rem;
    }

    .main-container {
      padding: 0.5rem;
    }

    .dashboard-section {
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .grid-2,
    .grid-3 {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .number-bubble {
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
    }

    .prediction-value {
      font-size: 2rem;
    }

    .pattern-box {
      font-size: 1.5rem;
      padding: 0.8rem 1.5rem;
      min-width: 120px;
    }

    .stats-grid {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    }

    .data-table {
      font-size: 0.75rem;
    }

    .data-table th,
    .data-table td {
      padding: 0.4rem 0.2rem;
    }
  }

  @media (max-width: 480px) {
    .header-title {
      font-size: 1.1rem;
    }

    .countdown-timer {
      font-size: 0.9rem;
      padding: 0.3rem 0.8rem;
    }

    .prediction-numbers {
      gap: 0.5rem;
    }

    .number-bubble {
      width: 45px;
      height: 45px;
      font-size: 1.3rem;
    }

    .pattern-box {
      font-size: 1.3rem;
      padding: 0.6rem 1rem;
      min-width: 100px;
    }

    .json-controls {
      flex-direction: column;
      align-items: stretch;
    }
  }

  /* --- Hidden Elements (Simulator & Refresh) --- */
  .hidden {
    display: none !important;
  }
</style>
</head>
<body>

<!-- Sticky Header -->
<div class="sticky-header">
  <div class="header-title">🎲 WinGo 1 Min Lottery Prediction Dashboard</div>
  <div class="header-info">
    <div class="timestamp-info">
      Last Updated: <span id="last-updated-time">--</span>
    </div>
    <div class="countdown-timer" id="countdown-timer">
      Next update in: -- seconds ⏳
    </div>
  </div>
</div>

<!-- Main Container -->
<div class="main-container">
  
  <!-- Error Message -->
  <div class="error-message" id="error-message"></div>

  <!-- Main Prediction Draw -->
  <div class="dashboard-section">
    <div class="section-header">
      🎯 Main Prediction Draw #<span id="draw-number">--</span>
    </div>
    <div class="prediction-display">
      <div class="prediction-numbers" id="predicted-numbers">
        <div class="number-bubble" style="background: #999;">Loading...</div>
      </div>
      <div class="grid-2" style="margin-top: 1rem;">
        <div>
          <strong>Big/Small:</strong> <span id="predicted-big-small">--</span>
          <div id="big-small-percentages" style="font-size: 0.9rem; margin-top: 0.3rem;"></div>
        </div>
        <div>
          <strong>Color:</strong> <span id="predicted-color">--</span>
          <div id="color-percentages" style="font-size: 0.9rem; margin-top: 0.3rem;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Color and Size Pattern Predictions -->
  <div class="grid-2">
    <div class="dashboard-section">
      <div class="section-header">🎨 Color Pattern Prediction (Red/Green)</div>
      <div class="pattern-display" id="color-prediction-display">
        <div class="pattern-box Pending">Loading...</div>
        <div id="color-prediction-meta" style="margin-top: 1rem; font-size: 0.9rem;">
          Awaiting data...
        </div>
      </div>
    </div>
    <div class="dashboard-section">
      <div class="section-header">📏 Size Pattern Prediction (Big/Small)</div>
      <div class="pattern-display" id="size-prediction-display">
        <div class="pattern-box Pending">Loading...</div>
        <div id="size-prediction-meta" style="margin-top: 1rem; font-size: 0.9rem;">
          Awaiting data...
        </div>
      </div>
    </div>
  </div>

  <!-- Sequence Pattern Analysis -->
  <div class="dashboard-section">
    <div class="section-header">📈 Sequence Pattern Analysis</div>
    <div id="sequence-analysis">
      <p>Loading sequence analysis...</p>
    </div>
  </div>

  <!-- AI Prediction Section -->
  <div class="grid-2">
    <div class="dashboard-section ai-section">
      <div class="section-header">
        🧠 AI Predicted Number
        <button class="ai-toggle-btn" id="ai-toggle-btn" onclick="toggleAI()">
          <span id="ai-toggle-btn-label">Start AI 🤖</span>
        </button>
      </div>
      <div class="prediction-card">
        <div class="prediction-value" id="ai-prediction-value">--</div>
        <div id="ai-prediction-display-badge"></div>
        <div class="prediction-meta" id="ai-prediction-meta">
          Issue: <span id="ai-issue">--</span><br>
          Last AI Run: <span id="ai-timestamp">--</span>
        </div>
      </div>
    </div>
    <div class="dashboard-section">
      <div class="section-header">📊 AI Big/Small Accuracy</div>
      <div class="prediction-card">
        <div class="prediction-value" id="ai-big-small-accuracy-value">--</div>
        <div class="prediction-meta" id="ai-big-small-accuracy-meta">
          Calculated: <span id="ai-accuracy-timestamp">--</span><br>
          Correct: <span id="ai-accuracy-correct">--</span> | 
          Total: <span id="ai-accuracy-total">--</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Previous Draw Number -->
  <div class="previous-draw" id="previous-draw">
    Loading previous draw information...
  </div>

  <!-- History Tables -->
  <div class="grid-2">
    <div class="dashboard-section">
      <div class="section-header">📜 Color Prediction History</div>
      <div style="overflow-x: auto;">
        <table class="data-table">
          <thead>
            <tr>
              <th>Issue #</th>
              <th>Predicted</th>
              <th>Rule</th>
              <th>Actual</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="color-history-table-body">
            <tr><td colspan="5">Loading color history...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="dashboard-section">
      <div class="section-header">📊 Size Prediction History</div>
      <div style="overflow-x: auto;">
        <table class="data-table">
          <thead>
            <tr>
              <th>Issue #</th>
              <th>Predicted</th>
              <th>Rule</th>
              <th>Actual</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="size-history-table-body">
            <tr><td colspan="5">Loading size history...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Main Statistics Prediction History -->
  <div class="dashboard-section">
    <div class="section-header">📜 Main Statistics Prediction History</div>
    <div style="overflow-x: auto;">
      <table class="data-table">
        <thead>
          <tr>
            <th>Draw #</th>
            <th>Predicted</th>
            <th>Actual</th>
            <th>Num</th>
            <th>B/S</th>
            <th>Color</th>
          </tr>
        </thead>
        <tbody id="history-table-body">
          <tr><td colspan="6">Loading main prediction history...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Performance and Streaks -->
  <div class="grid-3">
    <div class="dashboard-section">
      <div class="section-header">🚀 Color Performance & Streaks</div>
      <div id="color-performance-stats">
        <p>Loading color performance data...</p>
      </div>
    </div>
    <div class="dashboard-section">
      <div class="section-header">📊 Size Performance & Streaks</div>
      <div id="size-performance-stats">
        <p>Loading size performance data...</p>
      </div>
    </div>
    <div class="dashboard-section">
      <div class="section-header">📈 Main Performance & Streaks</div>
      <div id="main-performance-stats">
        <div class="stats-grid" id="accuracy-stats">
          <div class="stat-card">
            <div class="stat-label">Loading...</div>
            <div class="stat-value">--</div>
          </div>
        </div>
        <div class="stats-grid" id="streaks-stats" style="margin-top: 1rem;">
          <div class="stat-card">
            <div class="stat-label">Loading...</div>
            <div class="stat-value">--</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Raw API Responses -->
  <div class="dashboard-section">
    <div class="section-header">🔧 Raw API Responses</div>
    <div class="json-controls">
      <select id="raw-json-dropdown" class="json-dropdown" onchange="updateRawJsonDisplay()">
        <option value="prediction">Main Prediction</option>
        <option value="color_insights">Color Insights</option>
        <option value="size_insights">Size Insights</option>
        <option value="v2_insights">Combined Insights</option>
        <option value="ai_prediction">AI Prediction</option>
        <option value="ai_big_small_accuracy">AI B/S Accuracy</option>
        <option value="status">Status</option>
      </select>
    </div>
    <div class="json-display" id="raw-json-display">
      <button class="copy-btn" id="copy-json-btn">Copy</button>
      No data loaded yet.
    </div>
  </div>

  <!-- Hidden Elements (Simulator & Manual Refresh - functionality preserved but hidden) -->
  <div class="hidden">
    <button onclick="manualRefresh()">Hidden Refresh</button>
    <button onclick="window.location.href='/api/simulator/'">Hidden Simulator</button>
  </div>

</div>

<script>
  // All JavaScript functions remain the same - just the UI layout has changed
  const NUM_TO_COLOR_MAP = {
    0: 'Red', 1: 'Green', 2: 'Red', 3: 'Green', 4: 'Red',
    5: 'Green', 6: 'Red', 7: 'Green', 8: 'Red', 9: 'Green'
  };
  const COLOR_MAP = {
    0: {primary: 'Red', secondary: 'Violet'}, 1: {primary: 'Green', secondary: null},
    2: {primary: 'Red', secondary: null}, 3: {primary: 'Green', secondary: null},
    4: {primary: 'Red', secondary: null}, 5: {primary: 'Green', secondary: 'Violet'},
    6: {primary: 'Red', secondary: null}, 7: {primary: 'Green', secondary: null},
    8: {primary: 'Red', secondary: null}, 9: {primary: 'Green', secondary: null}
  };

  function createChip(text, color) {
    const safeText = text ? String(text) : '';
    const safeColor = color ? String(color).toLowerCase() : 'gray';
    const validColors = ['red', 'green', 'violet', 'gray', 'blue', 'gold'];
    const finalColor = validColors.includes(safeColor) ? safeColor : 'gray';
    return `<span class="chip ${finalColor}">${safeText}</span>`;
  }
  
  function createHistoryChip(text, type) {
    const safeText = text ? String(text) : 'Pending';
    let safeType = safeText === 'Pending' ? 'Pending' : safeText;
    if (!type.startsWith('Result-')) {
        safeType = 'Result-' + safeType;
    } else {
        safeType = type;
    }
    return `<span class="chip ${safeType}">${safeText}</span>`;
  }

  function formatTimestamp(isoString) {
    try {
      if (!isoString) return '--';
      const date = new Date(isoString);
      if (isNaN(date.getTime())) throw new Error("Invalid date string");
      return date.toLocaleString('en-US', {
        month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
      });
    } catch (e) {
      console.error("Error formatting timestamp:", e);
      return '-- Invalid --';
    }
  }

  let timerIntervalId = null;
  let countdownSeconds = 60;
  let lastApiTimestamp = null;
  
  const refreshTimes = [1.5, 5.0, 10.0, 58.5];

  let refreshGate = {
    '1.5': false,
    '5.0': false,
    '10.0': false,
    '58.5': false,
  };
  
  function checkRefreshTime() {
    const now = new Date();
    const currentSecond = now.getSeconds();
    const currentMs = now.getMilliseconds();
    
    if (currentSecond === 58 && currentMs >= 500 && !refreshGate['58.5']) {
      loadAllData();
      refreshGate['58.5'] = true;
    }
    if (currentSecond === 1 && currentMs >= 500 && !refreshGate['1.5']) {
      loadAllData();
      refreshGate['1.5'] = true;
    }
    if (currentSecond === 5 && currentMs >= 0 && currentMs <= 100 && !refreshGate['5.0']) {
      loadAllData();
      refreshGate['5.0'] = true;
    }
    if (currentSecond === 10 && currentMs >= 0 && currentMs <= 100 && !refreshGate['10.0']) {
      loadAllData();
      refreshGate['10.0'] = true;
    }
    
    if (currentMs < 100) {
      if (currentSecond !== 58 && refreshGate['58.5']) refreshGate['58.5'] = false;
      if (currentSecond !== 1 && refreshGate['1.5']) refreshGate['1.5'] = false;
      if (currentSecond !== 5 && refreshGate['5.0']) refreshGate['5.0'] = false;
      if (currentSecond !== 10 && refreshGate['10.0']) refreshGate['10.0'] = false;
    }
  }

  function updateCountdownDisplay() {
    if (!lastApiTimestamp) {
      document.getElementById('countdown-timer').textContent = "Next update in: -- seconds (No timestamp)";
      return;
    }
    const now = new Date();
    const apiDate = new Date(lastApiTimestamp);
    let elapsedSeconds = Math.floor((now.getTime() - apiDate.getTime()) / 1000);
    if (elapsedSeconds < 0) elapsedSeconds = 0;
    
    let remaining = countdownSeconds - (elapsedSeconds % countdownSeconds);
    if (remaining <= 1 && elapsedSeconds > 0) {
      remaining = countdownSeconds;
    }
    document.getElementById('countdown-timer').textContent = `Next update in: ${remaining}s ⏳`;
  }

  function manualRefresh() {
    document.getElementById('countdown-timer').textContent = `Refreshing...`;
    loadAllData();
  }
  
  let rawApiResponses = { 
    prediction: null, 
    ai_prediction: null, 
    status: null, 
    ai_big_small_accuracy: null, 
    color_insights: null,
    size_insights: null,
    v2_insights: null
  };

  function updateRawJsonDisplay() {
    const dropdown = document.getElementById('raw-json-dropdown');
    const display = document.getElementById('raw-json-display');
    const selected = dropdown.value;
    const content = rawApiResponses[selected] ? JSON.stringify(rawApiResponses[selected], null, 2) : `No data for ${selected}.`;
    
    if (!display.querySelector('#copy-json-btn')) {
        display.innerHTML = `<button class="copy-btn" id="copy-json-btn">Copy</button>${content}`;
    } else {
        display.innerHTML = `<button class="copy-btn" id="copy-json-btn">Copy</button>${content}`;
    }

    const copyBtn = document.getElementById('copy-json-btn');
    copyBtn.onclick = () => {
        navigator.clipboard.writeText(content)
            .then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                setTimeout(() => copyBtn.textContent = originalText, 1500);
            })
            .catch(err => console.error('Failed to copy text: ', err));
    };
  }

  let aiEnabled = false;

  async function fetchAIStatusAndUpdateBtn() {
    try {
      const res = await fetch('/api/ai/status');
      if (!res.ok) throw new Error('Failed to fetch AI status');
      const data = await res.json();
      aiEnabled = !!data.ai_enabled_flag;
    } catch (e) {
      aiEnabled = false;
      console.error("Error fetching AI status:", e);
      showErrorMessage("Failed to fetch AI status.");
    } finally {
      updateAIToggleBtn();
    }
  }

  function updateAIToggleBtn() {
    const btn = document.getElementById('ai-toggle-btn');
    const label = document.getElementById('ai-toggle-btn-label');
    const aiDisplayBadge = document.getElementById('ai-prediction-display-badge');
    if (!btn || !label || !aiDisplayBadge) return;
    if (aiEnabled) {
      btn.classList.add('active');
      label.textContent = 'Stop AI 🛑';
    } else {
      btn.classList.remove('active');
      label.textContent = 'Start AI 🤖';
      aiDisplayBadge.innerHTML = `<span class="ai-badge" style="background: #999;" title="AI is OFF">AI OFF</span>`;
    }
  }

  async function toggleAI() {
    const endpoint = aiEnabled ? '/api/ai/stop' : '/api/ai/start';
    document.getElementById('ai-toggle-btn').disabled = true;
    try {
      const res = await fetch(endpoint, { method: 'POST' });
      if (!res.ok) throw new Error((await res.json()).message || 'Unknown error');
      const data = await res.json();
      aiEnabled = !!data.ai_enabled_flag;
      updateAIToggleBtn();
      loadAIPredictionData();
      loadAIBigSmallAccuracy();
    } catch (e) {
      showErrorMessage('Failed to toggle AI: ' + e.message);
    } finally {
      document.getElementById('ai-toggle-btn').disabled = false;
    }
  }

  function showErrorMessage(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.style.display = "block";
      setTimeout(() => errorDiv.style.display = "none", 5000);
  }

  // Main Prediction Data Loading
  async function loadMainPredictionData() {
    try {
        const res = await fetch('/api/prediction');
        const data = await res.json();
        rawApiResponses['prediction'] = data;

        if (data.timestamp) {
            lastApiTimestamp = data.timestamp;
        }

        // Update last updated time
        document.getElementById('last-updated-time').textContent = formatTimestamp(data.timestamp);

        // Update previous draw info
        const prevDrawElem = document.getElementById('previous-draw');
        if (data.status === 'initializing') {
            prevDrawElem.innerHTML = `<span style="color: #ffc107;">⏳ Main prediction system initializing...</span>`;
        } else if (data.status === 'error') {
            prevDrawElem.innerHTML = `<span style="color: #e74c3c;">❌ Error: ${data.message}</span>`;
        } else {
            const drawNumber = data.next_issue || data.issue || '--';
            const prediction = data.prediction || {};
            const predictedNumbers = prediction.predicted_likelihoods || [];
            const bigSmall = prediction.big_small || '--';
            const color = prediction.color || '--';

            document.getElementById('draw-number').textContent = String(drawNumber).slice(-4);
            
            // Update predicted numbers bubbles
            const numbersContainer = document.getElementById('predicted-numbers');
            if (predictedNumbers && predictedNumbers.length > 0) {
                numbersContainer.innerHTML = '';
                [...predictedNumbers].sort((a, b) => b.likelihood - a.likelihood).forEach(item => {
                    const bubble = document.createElement('div');
                    bubble.className = 'number-bubble';
                    bubble.textContent = item.number;
                    
                    // Color coding for numbers
                    if ([0, 2, 4, 6, 8].includes(item.number)) {
                        bubble.style.background = 'linear-gradient(135deg, #e53935 0%, #c62828 100%)';
                    }
                    if ([1, 3, 5, 7, 9].includes(item.number)) {
                        bubble.style.background = 'linear-gradient(135deg, #4caf50 0%, #388e3c 100%)';
                    }
                    if ([0, 5].includes(item.number)) {
                        bubble.style.boxShadow = '0 0 15px 3px #9c27b0';
                    }
                    
                    const pctDiv = document.createElement('div');
                    pctDiv.className = 'bubble-pct';
                    pctDiv.textContent = `${item.likelihood.toFixed(1)}%`;
                    bubble.appendChild(pctDiv);
                    numbersContainer.appendChild(bubble);
                });
            } else {
                numbersContainer.innerHTML = '<div class="number-bubble" style="background: linear-gradient(135deg, #999 0%, #666 100%);">--</div>';
            }

            // Update big/small prediction
            document.getElementById('predicted-big-small').textContent = bigSmall;
            const bigSmallPercentages = document.getElementById('big-small-percentages');
            if (prediction.big_small_percentages) {
                bigSmallPercentages.innerHTML = Object.entries(prediction.big_small_percentages)
                    .map(([k, v]) => `<span style="margin-right: 1rem;">${k.replace('_percentage', '')}: ${v.toFixed(1)}%</span>`).join('');
            }

            // Update color prediction
            document.getElementById('predicted-color').textContent = color;
            const colorPercentages = document.getElementById('color-percentages');
            if (prediction.color_percentages) {
                colorPercentages.innerHTML = Object.entries(prediction.color_percentages)
                    .map(([k, v]) => `<span style="margin-right: 1rem;">${k}: ${v.toFixed(1)}%</span>`).join('');
            }

            // Update previous draw info
            if (data.recent_results) {
                const recentIssues = Object.keys(data.recent_results).sort((a,b) => b.localeCompare(a));
                if (recentIssues.length > 0) {
                    const lastIssueKey = recentIssues[0];
                    const lastNum = data.recent_results[lastIssueKey];
                    const lastColor = NUM_TO_COLOR_MAP[lastNum] || '--';
                    const lastSize = lastNum >= 5 ? 'Big' : 'Small';
                    prevDrawElem.innerHTML = `Previous Draw #${String(lastIssueKey).slice(-4)}: <strong>${lastNum}</strong> (${lastColor}, ${lastSize})`;
                }
            } else {
                prevDrawElem.innerHTML = `Current Prediction for Draw #${String(drawNumber).slice(-4)}`;
            }

            // Update sequence analysis
            const seqDiv = document.getElementById('sequence-analysis');
            if (data.sequence_analysis && data.sequence_analysis.length > 0) {
                seqDiv.innerHTML = data.sequence_analysis.map(item => `
                    <div style="background: rgba(102,126,234,0.1); padding: 1rem; margin-bottom: 0.5rem; border-radius: 8px; border-left: 4px solid #667eea;">
                        <p style="margin: 0; font-weight: 600;"><strong>Pattern [${item.pattern.join(', ')}]:</strong> ${item.predictions.map(p => `<span style="background: #667eea; color: white; padding: 0.2rem 0.5rem; border-radius: 15px; margin-right: 0.5rem;">${p.number}</span>`).join('')}</p>
                        <p style="color: #666; font-size: 0.9rem; margin: 0.5rem 0 0; font-style: italic;">${item.message}</p>
                    </div>
                `).join('');
            } else { 
                seqDiv.innerHTML = '<p style="color: #666; font-style: italic;">No significant patterns detected in recent draws.</p>'; 
            }

            updateMainPredictionHistory(data.prediction_history || []);
            updateMainPerformanceStats(data.accuracy, data.streaks);
        }

    } catch (err) {
        console.error("Failed to load main prediction data:", err);
        showErrorMessage(`Failed to load main prediction: ${err.message}`);
        document.getElementById('previous-draw').innerHTML = `<span style="color: #e74c3c;">❌ Failed to load main prediction data</span>`;
    }
  }

  function updateMainPredictionHistory(historyData) {
    const tbody = document.getElementById('history-table-body');
    if (!historyData || historyData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No main prediction history available.</td></tr>';
        return;
    }

    tbody.innerHTML = '';
    historyData.slice(0, 15).forEach(item => {
        const tr = document.createElement('tr');
        const pred = item.prediction || {};
        const res = item.result || {};
        const corr = item.correct || {};

        const predText = `<strong>${pred.number ? pred.number.join('/') : '--'}</strong><br>${pred.big_small || '--'}<br>${createHistoryChip(pred.color, `Result-${pred.color}`)}`;
        
        const actualNum = res.number !== undefined ? res.number : '--';
        const actualColors = (res.colors || []).filter(Boolean).map(c => createHistoryChip(c, `Result-${c}`)).join(' ');
        const actualBS = res.big_small || '--';
        
        const actualText = `<strong>${actualNum}</strong><br>${actualBS}<br>${actualColors}`;

        tr.innerHTML = `
            <td>${String(item.issue).slice(-4)}</td>
            <td>${predText}</td>
            <td>${actualText}</td>
            <td class="${corr.number ? 'correct' : 'incorrect'}">${corr.number ? '✔' : '✘'}</td>
            <td class="${corr.big_small ? 'correct' : 'incorrect'}">${corr.big_small ? '✔' : '✘'}</td>
            <td class="${corr.color ? 'correct' : 'incorrect'}">${corr.color ? '✔' : '✘'}</td>
        `;
        tbody.appendChild(tr);
    });
  }

  function updateMainPerformanceStats(accuracyStats, streakStats) {
    const accuracyContainer = document.getElementById('accuracy-stats');
    const streaksContainer = document.getElementById('streaks-stats');

    if (accuracyStats) {
        const parsePercent = (str) => (str || "0%").match(/(\d+\.?\d*)/)?.[0] || "0";
        accuracyContainer.innerHTML = `
            <div class="stat-card">
                <div class="stat-label">Numbers Accuracy</div>
                <div class="stat-value">${parsePercent(accuracyStats.number_accuracy)}%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Color Accuracy</div>
                <div class="stat-value">${parsePercent(accuracyStats.color_accuracy)}%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Big/Small Accuracy</div>
                <div class="stat-value">${parsePercent(accuracyStats.big_small_accuracy)}%</div>
            </div>
        `;
    } else {
        accuracyContainer.innerHTML = '<div class="stat-card"><div class="stat-label">Loading...</div><div class="stat-value">--</div></div>';
    }

    if (streakStats) {
        streaksContainer.innerHTML = '';
        Object.entries(streakStats).forEach(([key, val]) => {
            const label = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            streaksContainer.innerHTML += `
                <div class="stat-card">
                    <div class="stat-label">${label}</div>
                    <div class="stat-value" style="font-size: 1rem;">
                        Win: ${val.current_win || 0} (Max: ${val.max_win || 0})<br>
                        Loss: ${val.current_loss || 0} (Max: ${val.max_loss || 0})
                    </div>
                </div>
            `;
        });
    } else {
        streaksContainer.innerHTML = '<div class="stat-card"><div class="stat-label">Loading...</div><div class="stat-value">--</div></div>';
    }
  }

  // AI Prediction Functions
  async function loadAIPredictionData() {
    try {
      const res = await fetch('/api/ai/prediction');
      const data = await res.json();
      rawApiResponses['ai_prediction'] = data;

      const valueElem = document.getElementById('ai-prediction-value');
      const badgeElem = document.getElementById('ai-prediction-display-badge');
      const issueElem = document.getElementById('ai-issue');
      const timestampElem = document.getElementById('ai-timestamp');

      if (data.status === 'success' && data.ai_prediction !== undefined && data.ai_prediction !== null) {
        valueElem.textContent = data.ai_prediction;
        badgeElem.innerHTML = `<span class="ai-badge">AI ON</span>`;
        issueElem.textContent = String(data.issue || '--').slice(-4);
        timestampElem.textContent = formatTimestamp(data.timestamp);
      } else if (data.status === 'no_data') {
        valueElem.textContent = '--';
        badgeElem.innerHTML = aiEnabled ? `<span class="ai-badge">Waiting for data...</span>` : `<span class="ai-badge" style="background: #999;">AI OFF</span>`;
        issueElem.textContent = '--';
        timestampElem.textContent = '--';
      } else {
        valueElem.textContent = '⚠️';
        badgeElem.innerHTML = `<span class="ai-badge" style="background: #ff6b6b;">Error</span>`;
        issueElem.textContent = '--';
        timestampElem.textContent = '--';
      }
    } catch (err) {
      console.error("Failed to load AI prediction:", err);
      document.getElementById('ai-prediction-value').textContent = '❌';
      document.getElementById('ai-prediction-display-badge').innerHTML = `<span class="ai-badge" style="background: #ff6b6b;">Error</span>`;
    }
  }

  async function loadAIBigSmallAccuracy() {
    try {
      const res = await fetch('/api/ai/big-small-accuracy');
      const data = await res.json();
      rawApiResponses['ai_big_small_accuracy'] = data;

      const valueElem = document.getElementById('ai-big-small-accuracy-value');
      const timestampElem = document.getElementById('ai-accuracy-timestamp');
      const correctElem = document.getElementById('ai-accuracy-correct');
      const totalElem = document.getElementById('ai-accuracy-total');

      if (data.status === 'success' && data.overall_accuracy_percentage !== undefined) {
        valueElem.textContent = `${data.overall_accuracy_percentage}%`;
        timestampElem.textContent = formatTimestamp(data.timestamp);
        correctElem.textContent = data.correct_predictions || 0;
        totalElem.textContent = data.total_predictions || 0;
      } else {
        valueElem.textContent = '--';
        timestampElem.textContent = '--';
        correctElem.textContent = '--';
        totalElem.textContent = '--';
      }
    } catch (err) {
      console.error("Failed to load AI accuracy:", err);
      document.getElementById('ai-big-small-accuracy-value').textContent = '❌';
    }
  }

  // Color and Size Predictions
  async function loadColorInsights() {
    try {
      const res = await fetch('/api/color-insights');
      const data = await res.json();
      rawApiResponses['color_insights'] = data;

      const display = document.getElementById('color-prediction-display');
      const meta = document.getElementById('color-prediction-meta');

      if (data.status === 'success' && data.predictions) {
        const pred = data.predictions.next_prediction;
        const box = display.querySelector('.pattern-box') || document.createElement('div');
        box.className = `pattern-box ${pred || 'Pending'}`;
        box.textContent = pred || 'Pending';
        
        if (!display.querySelector('.pattern-box')) {
          display.innerHTML = '';
          display.appendChild(box);
        }

        // Update meta information
        const analysis = data.analysis || {};
        meta.innerHTML = `
          <strong>Pattern Analysis:</strong><br>
          Recent Sequence: <span style="font-family: monospace; background: rgba(102,126,234,0.1); padding: 2px 6px; border-radius: 4px;">${analysis.recent_sequence || 'Loading...'}</span><br>
          <strong>Rule:</strong> ${analysis.applied_rule || 'Analyzing patterns...'}<br>
          <strong>Confidence:</strong> ${analysis.confidence || '--'}%
        `;
      } else {
        display.innerHTML = '<div class="pattern-box Pending">Pending</div>';
        meta.innerHTML = 'Awaiting color pattern data...';
      }

      updateColorHistoryTable(data.prediction_history || []);
    } catch (err) {
      console.error("Failed to load color insights:", err);
      document.getElementById('color-prediction-display').innerHTML = '<div class="pattern-box Pending">Error</div>';
    }
  }

  async function loadSizeInsights() {
    try {
      const res = await fetch('/api/size-insights');
      const data = await res.json();
      rawApiResponses['size_insights'] = data;

      const display = document.getElementById('size-prediction-display');
      const meta = document.getElementById('size-prediction-meta');

      if (data.status === 'success' && data.predictions) {
        const pred = data.predictions.next_prediction;
        const box = display.querySelector('.pattern-box') || document.createElement('div');
        box.className = `pattern-box ${pred || 'Pending'}`;
        box.textContent = pred || 'Pending';
        
        if (!display.querySelector('.pattern-box')) {
          display.innerHTML = '';
          display.appendChild(box);
        }

        // Update meta information
        const analysis = data.analysis || {};
        meta.innerHTML = `
          <strong>Pattern Analysis:</strong><br>
          Recent Sequence: <span style="font-family: monospace; background: rgba(102,126,234,0.1); padding: 2px 6px; border-radius: 4px;">${analysis.recent_sequence || 'Loading...'}</span><br>
          <strong>Rule:</strong> ${analysis.applied_rule || 'Analyzing patterns...'}<br>
          <strong>Confidence:</strong> ${analysis.confidence || '--'}%
        `;
      } else {
        display.innerHTML = '<div class="pattern-box Pending">Pending</div>';
        meta.innerHTML = 'Awaiting size pattern data...';
      }

      updateSizeHistoryTable(data.prediction_history || []);
    } catch (err) {
      console.error("Failed to load size insights:", err);
      document.getElementById('size-prediction-display').innerHTML = '<div class="pattern-box Pending">Error</div>';
    }
  }

  function updateColorHistoryTable(historyData) {
    const tbody = document.getElementById('color-history-table-body');
    if (!historyData || historyData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5">No color prediction history available.</td></tr>';
        return;
    }

    tbody.innerHTML = '';
    historyData.slice(0, 10).forEach(item => {
        const tr = document.createElement('tr');
        const predicted = item.predicted || 'Pending';
        const actual = item.actual || 'Pending';
        const result = item.result || 'Pending';
        
        tr.innerHTML = `
            <td>${String(item.issue).slice(-4)}</td>
            <td>${createHistoryChip(predicted, `Result-${predicted}`)}</td>
            <td style="font-size: 0.75rem;">${item.rule || '--'}</td>
            <td>${createHistoryChip(actual, `Result-${actual}`)}</td>
            <td class="${result === 'Correct' ? 'correct' : result === 'Incorrect' ? 'incorrect' : ''}">${result === 'Correct' ? '✔' : result === 'Incorrect' ? '✘' : '--'}</td>
        `;
        tbody.appendChild(tr);
    });
  }

  function updateSizeHistoryTable(historyData) {
    const tbody = document.getElementById('size-history-table-body');
    if (!historyData || historyData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5">No size prediction history available.</td></tr>';
        return;
    }

    tbody.innerHTML = '';
    historyData.slice(0, 10).forEach(item => {
        const tr = document.createElement('tr');
        const predicted = item.predicted || 'Pending';
        const actual = item.actual || 'Pending';
        const result = item.result || 'Pending';
        
        tr.innerHTML = `
            <td>${String(item.issue).slice(-4)}</td>
            <td>${createHistoryChip(predicted, `Result-${predicted}`)}</td>
            <td style="font-size: 0.75rem;">${item.rule || '--'}</td>
            <td>${createHistoryChip(actual, `Result-${actual}`)}</td>
            <td class="${result === 'Correct' ? 'correct' : result === 'Incorrect' ? 'incorrect' : ''}">${result === 'Correct' ? '✔' : result === 'Incorrect' ? '✘' : '--'}</td>
        `;
        tbody.appendChild(tr);
    });
  }

  // Performance Stats Loading
  async function loadPerformanceStats() {
    try {
      // Load color performance
      const colorRes = await fetch('/api/color-insights');
      const colorData = await colorRes.json();
      const colorPerf = document.getElementById('color-performance-stats');
      
      if (colorData.performance) {
        colorPerf.innerHTML = `
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Accuracy</div>
              <div class="stat-value">${colorData.performance.accuracy || '--'}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Win Streak</div>
              <div class="stat-value">${colorData.performance.current_win_streak || 0}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Loss Streak</div>
              <div class="stat-value">${colorData.performance.current_loss_streak || 0}</div>
            </div>
          </div>
        `;
      } else {
        colorPerf.innerHTML = '<p>Loading color performance data...</p>';
      }

      // Load size performance
      const sizeRes = await fetch('/api/size-insights');
      const sizeData = await sizeRes.json();
      const sizePerf = document.getElementById('size-performance-stats');
      
      if (sizeData.performance) {
        sizePerf.innerHTML = `
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Accuracy</div>
              <div class="stat-value">${sizeData.performance.accuracy || '--'}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Win Streak</div>
              <div class="stat-value">${sizeData.performance.current_win_streak || 0}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Loss Streak</div>
              <div class="stat-value">${sizeData.performance.current_loss_streak || 0}</div>
            </div>
          </div>
        `;
      } else {
        sizePerf.innerHTML = '<p>Loading size performance data...</p>';
      }

    } catch (err) {
      console.error("Failed to load performance stats:", err);
    }
  }

  // Main data loading function
  async function loadAllData() {
    try {
      await Promise.all([
        loadMainPredictionData(),
        loadColorInsights(),
        loadSizeInsights(),
        loadAIPredictionData(),
        loadAIBigSmallAccuracy(),
        loadPerformanceStats(),
        fetchAIStatusAndUpdateBtn()
      ]);
      updateRawJsonDisplay();
    } catch (err) {
      console.error("Error loading dashboard data:", err);
      showErrorMessage("Failed to load some dashboard data");
    }
  }

  // Initialize dashboard
  document.addEventListener('DOMContentLoaded', function() {
    loadAllData();
    
    // Start timer for auto-refresh
    timerIntervalId = setInterval(() => {
      checkRefreshTime();
      updateCountdownDisplay();
    }, 100);
  });
</script>

</body>
</html>
